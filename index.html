<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Alphabet Train Game ðŸš‚</title>
  <style>
    body {
      background: linear-gradient(skyblue, #87ceeb 60%, #55aa33);
      font-family: "Comic Sans MS", cursive, sans-serif;
      text-align: center;
      margin: 0;
      overflow: hidden;
    }
    h1 {
      color: #ff3366;
      text-shadow: 2px 2px #fff;
      margin-top: 10px;
    }
    canvas {
      display: block;
      margin: 10px auto;
      background-color: #cceeff;
      border: 5px solid #333;
      border-radius: 15px;
    }
  </style>
</head>
<body>
  <h1>ðŸš‚ Alphabet Train Game ðŸŽˆ</h1>
  <canvas id="trainCanvas" width="800" height="400"></canvas>
  <audio id="trainSound" src="https://www.soundjay.com/transport/train-chugging-01.mp3" loop></audio>
  <audio id="celebrateSound" src="https://www.soundjay.com/human/cheering-6.mp3"></audio>

  <script>
    const canvas = document.getElementById("trainCanvas");
    const ctx = canvas.getContext("2d");
    const box = 40;
    const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
    let train = [{ x: 80, y: 320 }];
    let currentLetterIndex = 1;
    let direction = "RIGHT";
    let letter = getRandomLetterPosition();
    let gameOver = false;
    let smokePuffs = [];

    const trainSound = document.getElementById("trainSound");
    const celebrateSound = document.getElementById("celebrateSound");

    document.body.addEventListener("click", () => {
      // Start train sound on first user click (browser audio policy)
      trainSound.volume = 0.5;
      trainSound.play().catch(() => {});
    }, { once: true });

    function getRandomLetterPosition() {
      const cols = Math.floor(canvas.width / box);
      const rows = Math.floor(canvas.height / box);
      let pos;
      do {
        pos = {
          x: Math.floor(Math.random() * cols) * box,
          y: Math.floor(Math.random() * rows) * box
        };
      } while (train.some(seg => seg.x === pos.x && seg.y === pos.y));
      return pos;
    }

    function drawBackground() {
      // Sky
      const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
      gradient.addColorStop(0, "skyblue");
      gradient.addColorStop(1, "#55aa33");
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Sun
      ctx.beginPath();
      ctx.arc(750, 60, 35, 0, 2 * Math.PI);
      ctx.fillStyle = "yellow";
      ctx.fill();

      // Grass Hills
      ctx.fillStyle = "#44bb44";
      for (let i = 0; i < canvas.width; i += 200) {
        ctx.beginPath();
        ctx.arc(i + 100, 380, 100, 0, Math.PI, true);
        ctx.fill();
      }

      // Track
      ctx.fillStyle = "#8B4513";
      ctx.fillRect(0, 360, canvas.width, 10);
      for (let i = 0; i < canvas.width; i += 40) {
        ctx.fillStyle = "#aaa";
        ctx.fillRect(i + 5, 355, 10, 20);
      }
    }

    function drawTrain() {
      drawBackground();

      // Draw each carriage
      train.forEach((segment, i) => {
        const hue = (i * 45) % 360;
        const color = `hsl(${hue}, 80%, 55%)`;

        // Carriage body
        ctx.fillStyle = color;
        ctx.fillRect(segment.x, segment.y, box * 1.5, box);

        // Window
        ctx.fillStyle = "white";
        ctx.fillRect(segment.x + 10, segment.y + 8, 20, 20);

        // Wheels
        ctx.fillStyle = "black";
        ctx.beginPath();
        ctx.arc(segment.x + 10, segment.y + 40, 8, 0, 2 * Math.PI);
        ctx.arc(segment.x + 50, segment.y + 40, 8, 0, 2 * Math.PI);
        ctx.fill();

        // Engine front (first carriage)
        if (i === 0) {
          ctx.fillStyle = "#ff3333";
          ctx.fillRect(segment.x - 20, segment.y - 10, 20, 50);
          ctx.fillStyle = "black";
          ctx.beginPath();
          ctx.arc(segment.x - 10, segment.y + 40, 8, 0, 2 * Math.PI);
          ctx.fill();

          // Chimney
          ctx.fillStyle = "#444";
          ctx.fillRect(segment.x - 15, segment.y - 25, 8, 15);

          // Smoke puff
          if (Math.random() < 0.2) {
            smokePuffs.push({
              x: segment.x - 10,
              y: segment.y - 30,
              r: 6 + Math.random() * 5,
              alpha: 1
            });
          }
        }

        // Letter label
        ctx.fillStyle = "white";
        ctx.font = "bold 18px Comic Sans MS";
        ctx.textAlign = "center";
        ctx.fillText(alphabet[i], segment.x + box * 0.75, segment.y + 25);
      });

      // Draw smoke
      smokePuffs.forEach(puff => {
        ctx.globalAlpha = puff.alpha;
        ctx.fillStyle = "#eee";
        ctx.beginPath();
        ctx.arc(puff.x, puff.y, puff.r, 0, 2 * Math.PI);
        ctx.fill();
        ctx.globalAlpha = 1;
        puff.y -= 1;
        puff.alpha -= 0.02;
      });
      smokePuffs = smokePuffs.filter(p => p.alpha > 0);

      // Target letter
      if (!gameOver && currentLetterIndex < alphabet.length) {
        ctx.fillStyle = "#ff0000";
        ctx.fillRect(letter.x, letter.y, box, box);
        ctx.fillStyle = "white";
        ctx.font = "bold 22px Comic Sans MS";
        ctx.textAlign = "center";
        ctx.fillText(alphabet[currentLetterIndex], letter.x + box / 2, letter.y + 25);
      }
    }

    function moveTrain() {
      if (gameOver) return;

      const head = { ...train[0] };

      if (direction === "RIGHT") head.x += box;
      if (direction === "LEFT") head.x -= box;
      if (direction === "UP") head.y -= box;
      if (direction === "DOWN") head.y += box;

      // Wrap around
      if (head.x < 0) head.x = canvas.width - box;
      if (head.x >= canvas.width) head.x = 0;
      if (head.y < 0) head.y = canvas.height - box;
      if (head.y >= canvas.height) head.y = 0;

      // Check crash
      for (let i = 0; i < train.length; i++) {
        if (train[i].x === head.x && train[i].y === head.y) {
          gameOver = true;
          ctx.fillStyle = "red";
          ctx.font = "bold 36px Comic Sans MS";
          ctx.fillText("ðŸ’¥ Crash! Game Over ðŸ’¥", canvas.width / 2, canvas.height / 2);
          trainSound.pause();
          return;
        }
      }

      train.unshift(head);

      // Pick up letter
      if (head.x === letter.x && head.y === letter.y) {
        currentLetterIndex++;
        if (currentLetterIndex < alphabet.length) {
          letter = getRandomLetterPosition();
        } else {
          celebrate();
          gameOver = true;
          trainSound.pause();
        }
      } else {
        train.pop();
      }
    }

    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowUp" && direction !== "DOWN") direction = "UP";
      if (e.key === "ArrowDown" && direction !== "UP") direction = "DOWN";
      if (e.key === "ArrowLeft" && direction !== "RIGHT") direction = "LEFT";
      if (e.key === "ArrowRight" && direction !== "LEFT") direction = "RIGHT";
    });

    function gameLoop() {
      if (gameOver) return;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      moveTrain();
      drawTrain();
    }

    function celebrate() {
      celebrateSound.play();
      const confettiCount = 100;
      const confetti = [];
      for (let i = 0; i < confettiCount; i++) {
        confetti.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          r: Math.random() * 6 + 4,
          color: `hsl(${Math.random() * 360}, 100%, 60%)`,
          dy: Math.random() * 2 + 1
        });
      }

      function drawConfetti() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawBackground();
        ctx.font = "bold 36px Comic Sans MS";
        ctx.fillStyle = "purple";
        ctx.textAlign = "center";
        ctx.fillText("ðŸŽ‰ Hooray! You Collected Aâ€“Z! ðŸŽ‰", canvas.width / 2, canvas.height / 2);
        confetti.forEach(c => {
          ctx.beginPath();
          ctx.arc(c.x, c.y, c.r, 0, 2 * Math.PI);
          ctx.fillStyle = c.color;
          ctx.fill();
          c.y += c.dy;
          if (c.y > canvas.height) c.y = 0;
        });
        requestAnimationFrame(drawConfetti);
      }
      drawConfetti();
    }

    setInterval(gameLoop, 200);
  </script>
</body>
</html>
